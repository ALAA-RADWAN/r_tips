---
title: "Untangling strings (#@%*!!)"
author: Erika Duan
date: "`r Sys.Date()`"
output:
  github_document:
    toc: true
always_allow_html: true
---

```{r, echo = FALSE, message = FALSE, warning = FALSE}  
#-----load required packages-----  
if (!require("pacman")) install.packages("pacman")
pacman::p_load(here,  
               tidyverse,
               DT) # for visualising tables   
```


# Introduction   

Comment fields sit somewhere in between tidy tabular data entries and large text files (i.e. documents) in terms of wrangling effort. They still require human naunce to decode and more problematically, the quality and completeness of comment entries varies depending on individual engagement with reporting requirements.   

This can make it hard to gauge whether wrangling comment fields is a fruitful endeavour (especially when you have ten other data sources that need examining). Luckily, some knowledge of string manipulations and regular expressions can help simplify this process.      

# Creating a test dataset   

Let's imagine that my local chocolate company, [Haighs Chocolates](https://www.haighschocolates.com.au), wants to understand what food critics versus Haighs fans think about their newest product. They send out a bag of free samples with a link to an online survey that asks individuals to rate the chocolates (from a scale of 1 to 10) and provide additional comments.    

**Note:** The code used to create this dataset can be accessed from the `Rmd` file accompanying this tutorial.    

```{r, echo = FALSE, warning = FALSE}
#-----creating a test dataset-----
# this chunk of code has no other purpose except to provide us with an example dataset    

survey_list <- list(
  expert_1 = c(8, '<textarea name="comment" form="1"> Grade A beans. Easily melts. Smooth chocolate shell, with a crunchy malty filling, and not so sweet <p> I enjoyed this. </textarea>'), 
  
  expert_2 = c(7, '<textarea name="comment" form="1"> Grade A beans with subtle caramel hints. Melts well. Smooth exterior. Glossy coating. Malt-filled core may be too sweet for some. </textarea>'),  
  
  expert_3 = c(8, '<textarea name="comment" form="1"> Grade A beans. <p> Caramel and vanilla undertones complement the bitter dark chocolate - low sugar content and smooth chocolate shell. <p> Recommended. </textarea>'),  
  
  expert_4 = c(10, '<textarea name="comment" form="1"> Grade A cocoa beans. Melts easily. Smooth dark chocolate contrasts nicely against the crunchy malty filling. </textarea>'),  
  
  expert_5 = c(7, '<textarea name="comment" form="1"> Grade A beans, likely of Ecuador origin. Smooth dark chocolate coating. Malt filling ratio could be decreased. Easy to eat. </textarea>'),  
  
  fan_1 = c(9, '<textarea name="comment" form="1"> Delicious and melts in your mouth. The malt crunch is a nice touch <p> Would recommend. </textarea>'),  
  
  fan_2 = c(10, '<textarea name="comment" form="1"> Smooth dark chocolate shell likely made from grade A beans. Has some nice crunch. <p> This is definiely one of my new favourites! </textarea>'),  
  
  fan_3 = c(8, '<textarea name="comment" form="1"> Tastes great. Smooth and tasty chocolate. <p> Recommended. </textarea>'),  
  
  fan_4 = c(10, '<textarea name="comment" form="1"> This will be one of my new favourites. Love the malty interior! </textarea>'),  
  
  fan_5 = c(9, '<textarea name="comment" form="1"> Haighs has a history of using the best (grade A) beans. Love the caramel undertones. </textarea>'),  
  
  fan_6 = c(9, '<textarea name="comment" form="1"> Delicious!!! </textarea>')
)  

survey <- survey_list %>% 
  map_df(~ as_tibble(t(.))) # transpose list and convert into data frame  

survey <- survey %>%
  mutate(respondee = names(survey_list)) %>%
  rename("rating" = "V1",
         "comment_field" = "V2") %>%
  select(respondee, everything()) # reorder respondee as first column  
```

```{r}
#-----quickly visualise the test dataset-----  
survey %>%
  head(10) # fields containing html flags are not properly rendered by kable 
```


# Improve readability of comment fields  

```{r}
#-----readability with regex and comments-----  

```


# Other resources   

+ https://cran.r-project.org/web/packages/stringr/vignettes/regular-expressions.html  
+ https://r4ds.had.co.nz/strings.html  